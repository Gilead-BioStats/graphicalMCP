<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="graphicalMCP">
<title>Generating the closure tree • graphicalMCP</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generating the closure tree">
<meta property="og:description" content="graphicalMCP">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">graphicalMCP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/gen-weights.html">Generating the closure tree</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Generating the closure tree</h1>
            
      
      
      <div class="d-none name"><code>gen-weights.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://urban-sniffle-p11zlpj.pages.github.io/">graphicalMCP</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://gsrmtp.r-forge.r-project.org/" class="external-link">gMCP</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bench.r-lib.org/" class="external-link">bench</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/" class="external-link">forcats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jabiru/tictoc" class="external-link">tictoc</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>An emphasis of the graphicalMCP package is performance, and one place
where improved performance was especially needed was the function to
generate weights of all sub-graphs for an MCP graph -
<code><a href="https://rdrr.io/pkg/gMCP/man/generateWeights.html" class="external-link">gMCP::generateWeights()</a></code> or
<code><a href="../reference/generate_weights.html">graphicalMCP::generate_weights()</a></code>. We attempted to create
this function using three main strategies, and compared their speed and
memory performance with each other, as well as with the gMCP
implementation.</p>
</div>
<div class="section level2">
<h2 id="methodology">Methodology<a class="anchor" aria-label="anchor" href="#methodology"></a>
</h2>
<p>The sub-graphs of a graph can be thought of as a tree structure,
where each vertex is a sub-graph. The root of the tree is the initial
graph, and each successive level of the tree is created by deleting each
single node from the graphs in the level above.</p>
<div class="section level3">
<h3 id="each-from-initial---gw_original">Each-from-initial - <code>gw_original()</code><a class="anchor" aria-label="anchor" href="#each-from-initial---gw_original"></a>
</h3>
<p>The first and simplest method of generating sub-graph weights builds
on the exported <code><a href="../reference/update_graph.html">update_graph()</a></code> function, which takes a
graph and logical vector (h-vector) as arguments and deletes all the
hypotheses from the graph corresponding to the <code>FALSE</code>
entries in the h-vector. In this case, the whole closure of a graph is
generated as <code>2^n - 1</code> h-vectors. This can be done
efficiently with <code>expand.grid(rep(list(1:0), n))[-2^n, ]</code>,
where <code>n</code> is the number of hypotheses in the graph. Then the
initial graph is passed to <code><a href="../reference/update_graph.html">update_graph()</a></code> along with each
h-vector to determine the weights for each sub-graph.</p>
<p>This method is very straightforward, and the steps are clear.
However, it is not efficient because each element of the closure starts
with the full graph before deleting appropriate hypotheses. This means
that for a graph of size 5, hypothesis e.g. <code>3</code> gets deleted
to get to the <code>1-2-4-5</code> graph, and then again to get to the
<code>2-4-5</code> graph, and so on.</p>
</div>
<div class="section level3">
<h3 id="parent-child-recursive---generate_weights_recursive">Parent-child recursive -
<code>generate_weights_recursive()</code><a class="anchor" aria-label="anchor" href="#parent-child-recursive---generate_weights_recursive"></a>
</h3>
<p>Because of the tree structure of the closure of a graph, recursion is
a logical candidate for traversing it. In the recursive method, the
initial graph is the starting point still. Each hypothesis is deleted
from the initial graph, and the recursion is called on each of these
smaller graphs as a new starting point. This means that to get to a
sub-graph of size 2, it won’t start at size 5 and delete 3 hypotheses;
it will start at size 3 and delete a single hypothesis. For each level
of the recursion, the starting graph &amp; all sub-graphs are returned
in a list where each element is a graph. If the graph is an endpoint of
the recursion, just the graph is returned.</p>
<p>One of the keys to this method is that, whenever a hypothesis is
deleted and the resulting graph passed down the recursion, the
corresponding elements of the hypothesis and transition weights are
fully removed from the graph structure. This means that previously
deleted rows are not unnecessarily included in loops further down into
the recursion.</p>
<p>Furthermore, the recursive algorithm has a way to remember what the
last hypothesis removed was, and it only creates children by deleting
hypotheses larger than the last-deleted node. This avoids the situation
of creating level 3+ graphs multiple times by deleting the same nodes
but in a different order.</p>
<p>This method is quite fast, but still not the fastest. It is the most
memory-efficient.</p>
</div>
<div class="section level3">
<h3 id="parent-child-formula---generate_weights">Parent-child formula - <code>generate_weights()</code><a class="anchor" aria-label="anchor" href="#parent-child-formula---generate_weights"></a>
</h3>
<p>Using the recursive method created significant gains in speed and
memory efficiency, but one other way is even faster. The recursive
method generates a list of all sub-graphs, where each graph occurs after
its parent. This means that if there’s a formulaic way to find a graph’s
parent given the graph’s location in the list, the parent-child location
relationship could be calculated rather than generated with
recursion.</p>
<p>For the graph ordering generated by
<code>rev(expand.grid(rep(list(1:0), n))[-2^n, ])</code>, this formula
is straightforward. This ordering generates h-vectors that can be
thought of as binary numbers counting down from <code>2^n</code> to
<code>1</code>. This means that the bottom half of the h-vectors are
identical to the top half, except that the first entry is a 0 instead of
a 1. Thus, the parents of the bottom half, elements
<code>2^n / 2 -&gt; 1</code>, are the elements
<code>2^n -&gt; 2^n / 2 + 1</code>. And the node to delete to move from
an element in the top half to an element in the bottom half is the
first. This same logic then applies to the top half and the bottom half
individually, ignoring element 1. Each time the set of h-vectors is
divided in half, it yields the h-vectors for a graph of size
<code>n - 1</code> in each half.</p>
<p>Without generating the h-vectors at all, the parent index and
node-to-delete index can be calculated directly. The parent index vector
is sequential blocks of <code>1:(2^k)</code> sequences, and the
node-to-delete vector is sequential blocks of <code>n - k</code>
repeated <code>k + 1</code> times, with
<code>0 &lt;= k &lt;= n - 1</code>. Both vectors have the last element
removed, which corresponds to creating the empty sub-graph.</p>
<div class="section level4">
<h4 id="proof-idea">Proof idea<a class="anchor" aria-label="anchor" href="#proof-idea"></a>
</h4>
<p>Let <code>g</code> be a valid MCP graph with <code>n</code>
hypotheses. We proceed by induction on <code>n</code>.</p>
<div class="section level5">
<h5 id="intuition-and-base-cases">Intuition and base cases<a class="anchor" aria-label="anchor" href="#intuition-and-base-cases"></a>
</h5>
<p>Let <code>n</code> = 1. Then the closure of <code>g</code> is simply
the trivial sub-graph, <code>g</code>. The parent and delete vectors are
empty.</p>
<p>Let <code>n</code> = 2. Then the closure of <code>g</code> is
<code>(1, 1), (1, 0), (0, 1)</code>. The parent vector is
<code>(1, 1)</code>, and the delete vector is <code>(2, 1)</code>.</p>
<p>Let <code>n</code> = 3. Then the closure of <code>g</code> is
<code>(1, 1, 1), (1, 1, 0), (1, 0, 1), (1, 0, 0), (0, 1, 1), (0, 1, 0), (0, 0, 1)</code>.
The parent vector is <code>(1, 1, 2, 1, 2, 3)</code>, and the delete
vector is <code>(3, 2, 2, 1, 1, 1)</code>.</p>
</div>
<div class="section level5">
<h5 id="inductive-step">Inductive step<a class="anchor" aria-label="anchor" href="#inductive-step"></a>
</h5>
<p>Suppose these formulas hold for a graph of size <code>n - 1</code>.
Then the closure is <code>2^(n - 1) -&gt; 1</code> in binary, the parent
vector is sequential <code>1:2^k</code> sequences, and the delete vector
is sequential blocks of <code>n - 1 - k</code> repeated
<code>k + 1</code> times, with <code>0 &lt;= k &lt;= n - 2</code>. Add a
hypothesis to get to a graph of size <code>n</code>. Then the new
closure is the <code>n - 1</code> closure repeated twice, with a 1
before the first repeat, and a 0 before the second. Thus the difference
between a row in the top half and corresponding row in the bottom half
is <code>2^(n - 1)</code>. And the only difference in elements between
such rows is the first element has switched from 1 to 0. Thus, the
parent index of a row in the bottom half is the corresponding row in the
top half, and the node to delete is the first.</p>
<p><span style="float:right"><span class="math inline">\(\blacksquare\)</span></span></p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="performance">Performance<a class="anchor" aria-label="anchor" href="#performance"></a>
</h2>
<p>We analyzed performance of the various methods using the bench
package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_benchmarks</span> <span class="op">&lt;-</span> <span class="fu">xfun</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xfun/man/cache_rds.html" class="external-link">cache_rds</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">sizes</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">:</span><span class="fl">12</span></span>
<span></span>
<span>    <span class="va">list_benchmarks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>      <span class="va">sizes</span>,</span>
<span>      <span class="kw">function</span><span class="op">(</span><span class="va">size</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">bh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bonferroni_holm.html">bonferroni_holm</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span></span>
<span>        <span class="va">trn</span> <span class="op">&lt;-</span> <span class="va">bh</span><span class="op">$</span><span class="va">transitions</span></span>
<span>        <span class="va">hyp</span> <span class="op">&lt;-</span> <span class="va">bh</span><span class="op">$</span><span class="va">hypotheses</span></span>
<span></span>
<span>        <span class="va">b_mark</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="../reference/generate_weights.html">gw_original</a></span><span class="op">(</span><span class="va">bh</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/gMCP/man/generateWeights.html" class="external-link">generateWeights</a></span><span class="op">(</span><span class="va">trn</span>, <span class="va">hyp</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="../reference/generate_weights.html">generate_weights_recursive</a></span><span class="op">(</span><span class="va">bh</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="../reference/generate_weights.html">generate_weights</a></span><span class="op">(</span><span class="va">bh</span><span class="op">)</span>,</span>
<span>          check <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          min_iterations <span class="op">=</span> <span class="fl">5</span>,</span>
<span>          time_unit <span class="op">=</span> <span class="st">"ms"</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span>        <span class="va">b_mark</span><span class="op">$</span><span class="va">size</span> <span class="op">&lt;-</span> <span class="va">size</span></span>
<span>        <span class="va">b_mark</span><span class="op">$</span><span class="va">mem_alloc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">b_mark</span><span class="op">$</span><span class="va">mem_alloc</span><span class="op">)</span></span>
<span></span>
<span>        <span class="va">b_mark</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">list_benchmarks</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  clean <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>All methods increase in time by <code>O(2^n)</code>, but the starting
point is lowest for <code><a href="../reference/generate_weights.html">generate_weights()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_benchmarks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_benchmarks</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_benchmarks</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span>,</span>
<span>      <span class="va">median</span>,</span>
<span>      colour <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">expression</span><span class="op">)</span>, <span class="va">size</span>, <span class="va">median</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    colour <span class="op">=</span> <span class="st">"Expression"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Log of median runtime in milliseconds"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Graph size"</span>,</span>
<span>    y <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="gen-weights_files/figure-html/gg-benchmarks-runtime-1.png" width="672"></p>
<p>Memory also increases at about <code>O(2^n)</code>, but here the
recursive solution shows a slight advantage.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_benchmarks</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span>,</span>
<span>      <span class="va">mem_alloc</span>,</span>
<span>      colour <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">expression</span><span class="op">)</span>, <span class="va">size</span>, <span class="va">median</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    colour <span class="op">=</span> <span class="st">"Expression"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Log of bytes used"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Graph size"</span>,</span>
<span>    y <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="gen-weights_files/figure-html/gg-benchmarks-memory-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="performance-example">Performance example<a class="anchor" aria-label="anchor" href="#performance-example"></a>
</h2>
<p>In order to further demonstrate the performance improvement, we will
simulate a size 17 graph and generate weights in 2 different ways.
Results can be demonstrated to be equivalent, and the time difference
will be shown as well. We can see that the performance improvement is
significant, especially for larger graphs.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_methods</span> <span class="op">&lt;-</span> <span class="fu">xfun</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xfun/man/cache_rds.html" class="external-link">cache_rds</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1818</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">18</span></span>
<span>    </span>
<span>    <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">m</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">w</span> <span class="op">&lt;-</span> <span class="va">w</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">m</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">m</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"graphMCP"</span>, m <span class="op">=</span> <span class="va">g</span>, weights <span class="op">=</span> <span class="va">w</span><span class="op">)</span></span>
<span>    <span class="va">graph2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_graph.html">create_graph</a></span><span class="op">(</span><span class="va">w</span>, <span class="va">g</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="st">"gMCP::generateWeights()"</span><span class="op">)</span></span>
<span>    <span class="va">gMCP_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gMCP/man/generateWeights.html" class="external-link">generateWeights</a></span><span class="op">(</span><span class="va">graph</span><span class="op">)</span></span>
<span>    <span class="va">tictoc_gmcp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">callback_msg</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="st">"graphicalMCP::generate_weights()"</span><span class="op">)</span></span>
<span>    <span class="va">graphicalMCP_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_weights.html">generate_weights</a></span><span class="op">(</span><span class="va">graph2</span><span class="op">)</span></span>
<span>    <span class="va">tictoc_graphicalmcp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">callback_msg</span></span>
<span>    </span>
<span>    <span class="co"># Order of results is reversed between packages, and column names differ,</span></span>
<span>    <span class="co"># but values are the same</span></span>
<span>    <span class="va">res_equal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">gMCP_weights</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">gMCP_weights</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">graphicalMCP_weights</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">tictoc_gmcp</span>, <span class="va">tictoc_graphicalmcp</span>, <span class="va">res_equal</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  clean <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">check_methods</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">##&gt; gMCP::generateWeights(): 1252.024 sec elapsed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">check_methods</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">##&gt; graphicalMCP::generate_weights(): 25.524 sec elapsed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>  <span class="st">"Results from the two packages are equal (up to ordering &amp; names):"</span>,</span>
<span>  <span class="va">check_methods</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="st">"\n"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">##&gt; Results from the two packages are equal (up to ordering &amp; names): TRUE</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Dong Xi, Ethan Brockmann, Gilead Biostatistics.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
